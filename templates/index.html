<!DOCTYPE html>
<html>
<head>
    <title>Food Classifier</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: #333; text-align: center; margin-bottom: 10px; font-size: 2.5em; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        .upload-area { border: 3px dashed #667eea; border-radius: 10px; padding: 40px; text-align: center; margin: 20px 0; background: #f8f9ff; transition: all 0.3s; }
        .upload-area:hover { background: #e8e9ff; border-color: #764ba2; }
        input[type="file"] { display: none; }
        .upload-btn { background: #667eea; color: white; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .upload-btn:hover { background: #764ba2; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .predict-btn { background: #28a745; color: white; padding: 15px 40px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; width: 100%; margin: 20px 0; transition: all 0.3s; }
        .predict-btn:hover { background: #218838; transform: translateY(-2px); }
        .predict-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        #preview { max-width: 100%; max-height: 400px; margin: 20px auto; display: none; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        #results { margin-top: 30px; padding: 25px; background: #f8f9ff; border-radius: 10px; display: none; }
        .result-item { margin: 15px 0; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .label { font-weight: bold; color: #667eea; font-size: 1.1em; }
        .value { color: #333; font-size: 1.2em; margin-top: 5px; }
        .nutrition { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
        .nutrition-item { background: #667eea; color: white; padding: 15px; border-radius: 8px; text-align: center; }
        .nutrition-item span { display: block; font-size: 1.5em; font-weight: bold; margin-top: 5px; }
        .prob-bar { background: #e0e0e0; border-radius: 5px; overflow: hidden; margin: 8px 0; }
        .prob-fill { background: linear-gradient(90deg, #667eea, #764ba2); height: 25px; transition: width 0.5s; display: flex; align-items: center; padding: 0 10px; color: white; font-size: 12px; }
        .loading { display: none; text-align: center; margin: 20px 0; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçï Food Classifier</h1>
        <p class="subtitle">Upload a food image to identify it and get nutrition information</p>
        
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <p style="font-size: 3em; margin-bottom: 10px;">üì∏</p>
            <p style="font-size: 1.2em; color: #666;">Click to upload or drag & drop</p>
            <p style="color: #999; margin-top: 10px;">Supports: JPG, PNG</p>
        </div>
        
        <input type="file" id="fileInput" accept="image/*" onchange="previewImage(event)">
        <img id="preview">
        <button class="predict-btn" id="predictBtn" onclick="predict()" disabled>üîç Classify Food</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: #667eea;">Analyzing...</p>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        let uploadedFile = null;

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                uploadedFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    document.getElementById('predictBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        async function predict() {
            if (!uploadedFile) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('predictBtn').disabled = true;

            const formData = new FormData();
            formData.append('file', uploadedFile);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                displayResults(data);
            } catch (error) {
                alert('Error: ' + error);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('predictBtn').disabled = false;
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            
            let html = `
                <div class="result-item">
                    <div class="label">Predicted Food</div>
                    <div class="value" style="font-size: 2em; color: #667eea;">üçΩÔ∏è ${data.class}</div>
                    <div style="margin-top: 10px; color: #28a745; font-size: 1.3em;">
                        Confidence: ${data.confidence}%
                    </div>
                </div>

                <div class="result-item">
                    <div class="label">Nutrition Information (per serving)</div>
                    <div class="nutrition">
                        <div class="nutrition-item">
                            <div>Calories</div>
                            <span>${data.nutrition.calories} kcal</span>
                        </div>
                        <div class="nutrition-item">
                            <div>Protein</div>
                            <span>${data.nutrition.protein}g</span>
                        </div>
                        <div class="nutrition-item">
                            <div>Fat</div>
                            <span>${data.nutrition.fat}g</span>
                        </div>
                        <div class="nutrition-item">
                            <div>Fiber</div>
                            <span>${data.nutrition.fiber}g</span>
                        </div>
                        <div class="nutrition-item">
                            <div>Carbs</div>
                            <span>${data.nutrition.carbs}g</span>
                        </div>
                    </div>
                </div>

                <div class="result-item">
                    <div class="label">All Class Probabilities</div>
            `;

            const sortedProbs = Object.entries(data.probabilities).sort((a, b) => b[1] - a[1]);
            sortedProbs.forEach(([name, prob]) => {
                html += `
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${name}</span>
                            <span style="font-weight: bold;">${prob}%</span>
                        </div>
                        <div class="prob-bar">
                            <div class="prob-fill" style="width: ${prob}%;"></div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
